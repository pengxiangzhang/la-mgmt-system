<% content_for :title, "System Setting - Admin" %>
<div class="card">
  <h5 class="card-header">System Setting</h5>
  <div class="card-body">
    <h5 class="card-title">System URL
      <span class="tooltip-element" tooltip="Put the url of the LA management system here">?</span></h5>
    <%= form_tag(management_system_url_url, method: "post", id: "system_url_edit", onSubmit: "return confirm('Do you want to change the system url to '+system_url.value+'?') ") do %>
      <div class="row">
        <div class="col">
          <input type="text" class="form-control" name="system_url" value=<%= SystemValue.find_by(name: 'system_url').value %> id="system_url" required="required">
        </div>
        <div class="col">
          <%= submit_tag("Submit Request", class: "btn btn-primary float-right", id: "submit") %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<br>
<div class="card">
  <h5 class="card-header">User List</h5>
  <div class="card-body">
    <h5 class="card-title">Change usertype by list</h5>
    <table class="table" id="user-table">
      <thead>
      <tr>
        <th style="white-space: nowrap">UserName</th>
        <th style="white-space: nowrap">Role</th>
        <th style="white-space: nowrap">Action</th>
      </tr>
      </thead>
      <tbody>
      <% @users.each do |user| %>
        <tr>
          <td><%= user.eduPersonPrincipalName %></td>
          <td><%= user.Role %></td>
          <td>

            <%= form_tag(management_role_form_url, method: "post", id: "role_form_" + user.eduPersonPrincipalName, onSubmit: "return confirm('Do you want to change '+username.value+' to '+user_type.value+'?') ") do %>
              <div class="row">
                <div class="col">
                  <input type="hidden" name="username" value=<%= user.eduPersonPrincipalName %>>
                  <%= select_tag(:user_type, options_for_select([['Admin', "admin"], ['LA', "la"], ['Student', "student"]]), class: "form-control", :include_blank => true) %>
                </div>
                <div class="col">
                  <%= submit_tag("Submit Request", class: "btn btn-primary", id: "submit") %>
                </div>
              </div>
            <% end %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>

<script defer type="text/javascript">
    $(document).ready(function () {
        $('#user-table').DataTable({
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
            dom: 'Bfrtip',
            columnDefs: [{
                targets: 2,
                searchable: false,
                visible: true
            }],
            buttons: ['pageLength'
                , {
                    text: 'All',
                    action: function () {
                        location.reload(true);
                    }
                },
                {
                    text: 'Student',
                    action: function () {
                        var table = $('#user-table').DataTable();
                        table.column(1).search('student').draw();
                    }
                },
                {
                    text: 'LA',
                    action: function () {
                        var table = $('#user-table').DataTable();
                        table.column(1).search('la').draw();
                    }
                },
                {
                    text: 'Admin',
                    action: function () {
                        var table = $('#user-table').DataTable();
                        table.column(1).search('admin').draw();
                    }
                }]
        })
    });
</script>